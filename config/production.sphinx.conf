indexer
{
}

searchd
{
  listen = 127.0.0.1:9312
  log = /home/paul/Code/tourism/log/searchd.log
  query_log = /home/paul/Code/tourism/log/searchd.query.log
  pid_file = /home/paul/Code/tourism/log/searchd.production.pid
}

source claim_core_0
{
  type = pgsql
  sql_host = localhost
  sql_user = paul
  sql_pass = 
  sql_db = production_development
  sql_port = 5433
  sql_query_pre = UPDATE "claims" SET "delta" = FALSE WHERE "delta" = TRUE
  sql_query_pre = SET TIME ZONE 'UTC'
  sql_query = SELECT "claims"."id" * 1::INT8 + 0 AS "id" , "claims"."airport_to" AS "airport_to", "claims"."airport_back" AS "airport_back", "claims"."flight_to" AS "flight_to", "claims"."flight_back" AS "flight_back", "claims"."meals" AS "meals", "claims"."placement" AS "placement", "claims"."hotel" AS "hotel", "claims"."memo" AS "memo", "claims"."transfer" AS "transfer", "claims"."relocation" AS "relocation", "claims"."service_class" AS "service_class", "claims"."additional_services" AS "additional_services", "users"."last_name" AS "user", "offices"."name" AS "office", "operators"."name" AS "operator", "countries"."name" AS "country", "cities"."name" AS "city", "resorts_claims"."name" AS "resort", array_to_string(array_agg(COALESCE(CAST(COALESCE("tourists"."last_name", '') as varchar) || ' ' || CAST(COALESCE("tourists"."first_name", '') as varchar), '0')), ' ') AS "dependents", CAST(COALESCE("applicants_claims"."last_name", '') as varchar) || ' ' || CAST(COALESCE("applicants_claims"."first_name", '') as varchar) AS "applicant", "claims"."id" AS "sphinx_internal_id", 0 AS "sphinx_deleted", 1722347811 AS "class_crc", COALESCE("users"."last_name", '') AS "user_sort", COALESCE("offices"."name", '') AS "office_sort", COALESCE("operators"."name", '') AS "operator_sort", COALESCE("countries"."name", '') AS "country_sort", COALESCE("cities"."name", '') AS "city_sort", COALESCE("resorts_claims"."name", '') AS "resort_sort", array_to_string(array_agg(COALESCE(COALESCE("tourists"."last_name", '') || ' ' || COALESCE("tourists"."first_name", ''), '0')), ' ') AS "dependents_sort" FROM "claims" LEFT OUTER JOIN "users" ON "users"."id" = "claims"."user_id" LEFT OUTER JOIN "offices" ON "offices"."id" = "claims"."office_id" LEFT OUTER JOIN "operators" ON "operators"."id" = "claims"."operator_id" LEFT OUTER JOIN "countries" ON "countries"."id" = "claims"."country_id" LEFT OUTER JOIN "cities" ON "cities"."id" = "claims"."city_id" LEFT OUTER JOIN "cities" "resorts_claims" ON "resorts_claims"."id" = "claims"."resort_id" LEFT OUTER JOIN "tourist_claims" ON "tourist_claims"."claim_id" = "claims"."id" AND "tourist_claims"."applicant" = 'f' LEFT OUTER JOIN "tourists" ON "tourists"."id" = "tourist_claims"."tourist_id" LEFT OUTER JOIN "tourist_claims" "tourist_claims_claims_join" ON "tourist_claims_claims_join"."claim_id" = "claims"."id" AND "tourist_claims_claims_join"."applicant" = 't' LEFT OUTER JOIN "tourists" "applicants_claims" ON "applicants_claims"."id" = "tourist_claims_claims_join"."tourist_id" WHERE ("claims"."id" >= $start AND "claims"."id" <= $end AND "claims"."delta" = FALSE) GROUP BY "claims"."id", "claims"."airport_to", "claims"."airport_back", "claims"."flight_to", "claims"."flight_back", "claims"."meals", "claims"."placement", "claims"."hotel", "claims"."memo", "claims"."transfer", "claims"."relocation", "claims"."service_class", "claims"."additional_services", "users"."last_name", "offices"."name", "operators"."name", "countries"."name", "cities"."name", "resorts_claims"."name", "applicants_claims"."last_name", "applicants_claims"."first_name", "claims"."id", "users"."last_name", "offices"."name", "operators"."name", "countries"."name", "cities"."name", "resorts_claims"."name"
  sql_query_range = SELECT COALESCE(MIN("id"), 1::bigint), COALESCE(MAX("id"), 1::bigint) FROM "claims" WHERE "claims"."delta" = FALSE
  sql_attr_uint = sphinx_internal_id
  sql_attr_uint = sphinx_deleted
  sql_attr_uint = class_crc
  sql_attr_str2ordinal = user_sort
  sql_attr_str2ordinal = office_sort
  sql_attr_str2ordinal = operator_sort
  sql_attr_str2ordinal = country_sort
  sql_attr_str2ordinal = city_sort
  sql_attr_str2ordinal = resort_sort
  sql_attr_str2ordinal = dependents_sort
  sql_query_info = SELECT * FROM "claims" WHERE "id" = (($id - 0) / 1)
}

index claim_core
{
  source = claim_core_0
  path = /home/paul/Code/tourism/db/sphinx/production/claim_core
  charset_type = utf-8
}

source claim_delta_0 : claim_core_0
{
  type = pgsql
  sql_host = localhost
  sql_user = paul
  sql_pass = 
  sql_db = production_development
  sql_port = 5433
  sql_query_pre = 
  sql_query_pre = SET TIME ZONE 'UTC'
  sql_query = SELECT "claims"."id" * 1::INT8 + 0 AS "id" , "claims"."airport_to" AS "airport_to", "claims"."airport_back" AS "airport_back", "claims"."flight_to" AS "flight_to", "claims"."flight_back" AS "flight_back", "claims"."meals" AS "meals", "claims"."placement" AS "placement", "claims"."hotel" AS "hotel", "claims"."memo" AS "memo", "claims"."transfer" AS "transfer", "claims"."relocation" AS "relocation", "claims"."service_class" AS "service_class", "claims"."additional_services" AS "additional_services", "users"."last_name" AS "user", "offices"."name" AS "office", "operators"."name" AS "operator", "countries"."name" AS "country", "cities"."name" AS "city", "resorts_claims"."name" AS "resort", array_to_string(array_agg(COALESCE(CAST(COALESCE("tourists"."last_name", '') as varchar) || ' ' || CAST(COALESCE("tourists"."first_name", '') as varchar), '0')), ' ') AS "dependents", CAST(COALESCE("applicants_claims"."last_name", '') as varchar) || ' ' || CAST(COALESCE("applicants_claims"."first_name", '') as varchar) AS "applicant", "claims"."id" AS "sphinx_internal_id", 0 AS "sphinx_deleted", 1722347811 AS "class_crc", COALESCE("users"."last_name", '') AS "user_sort", COALESCE("offices"."name", '') AS "office_sort", COALESCE("operators"."name", '') AS "operator_sort", COALESCE("countries"."name", '') AS "country_sort", COALESCE("cities"."name", '') AS "city_sort", COALESCE("resorts_claims"."name", '') AS "resort_sort", array_to_string(array_agg(COALESCE(COALESCE("tourists"."last_name", '') || ' ' || COALESCE("tourists"."first_name", ''), '0')), ' ') AS "dependents_sort" FROM "claims" LEFT OUTER JOIN "users" ON "users"."id" = "claims"."user_id" LEFT OUTER JOIN "offices" ON "offices"."id" = "claims"."office_id" LEFT OUTER JOIN "operators" ON "operators"."id" = "claims"."operator_id" LEFT OUTER JOIN "countries" ON "countries"."id" = "claims"."country_id" LEFT OUTER JOIN "cities" ON "cities"."id" = "claims"."city_id" LEFT OUTER JOIN "cities" "resorts_claims" ON "resorts_claims"."id" = "claims"."resort_id" LEFT OUTER JOIN "tourist_claims" ON "tourist_claims"."claim_id" = "claims"."id" AND "tourist_claims"."applicant" = 'f' LEFT OUTER JOIN "tourists" ON "tourists"."id" = "tourist_claims"."tourist_id" LEFT OUTER JOIN "tourist_claims" "tourist_claims_claims_join" ON "tourist_claims_claims_join"."claim_id" = "claims"."id" AND "tourist_claims_claims_join"."applicant" = 't' LEFT OUTER JOIN "tourists" "applicants_claims" ON "applicants_claims"."id" = "tourist_claims_claims_join"."tourist_id" WHERE ("claims"."id" >= $start AND "claims"."id" <= $end AND "claims"."delta" = TRUE) GROUP BY "claims"."id", "claims"."airport_to", "claims"."airport_back", "claims"."flight_to", "claims"."flight_back", "claims"."meals", "claims"."placement", "claims"."hotel", "claims"."memo", "claims"."transfer", "claims"."relocation", "claims"."service_class", "claims"."additional_services", "users"."last_name", "offices"."name", "operators"."name", "countries"."name", "cities"."name", "resorts_claims"."name", "applicants_claims"."last_name", "applicants_claims"."first_name", "claims"."id", "users"."last_name", "offices"."name", "operators"."name", "countries"."name", "cities"."name", "resorts_claims"."name"
  sql_query_range = SELECT COALESCE(MIN("id"), 1::bigint), COALESCE(MAX("id"), 1::bigint) FROM "claims" WHERE "claims"."delta" = TRUE
  sql_attr_uint = sphinx_internal_id
  sql_attr_uint = sphinx_deleted
  sql_attr_uint = class_crc
  sql_attr_str2ordinal = user_sort
  sql_attr_str2ordinal = office_sort
  sql_attr_str2ordinal = operator_sort
  sql_attr_str2ordinal = country_sort
  sql_attr_str2ordinal = city_sort
  sql_attr_str2ordinal = resort_sort
  sql_attr_str2ordinal = dependents_sort
  sql_query_info = SELECT * FROM "claims" WHERE "id" = (($id - 0) / 1)
}

index claim_delta : claim_core
{
  source = claim_delta_0
  path = /home/paul/Code/tourism/db/sphinx/production/claim_delta
}

index claim
{
  type = distributed
  local = claim_delta
  local = claim_core
}
