- task = @task unless local_assigns[:task]
%tr{id: "task-#{task.id}", class: task.bug && 'bug'}
  %td{ class: task.bug && 'red_back' }
    = task.id
  %td.body.popup_hover{:class => task.status =='cancel' && 'del', :title => "\##{task.id} - #{t('task_type.' + (task.bug ? 'bug' : 'offer'))}", :data => { :content => task.body }}
    = truncate task.body, length: 80, omission: '...', separator: ' '
  %td.comment.popup_hover{ :title => "\##{task.id} Комментарий", :data => { :content => task.comment }}
    = truncate task.comment, length: 80, omission: '...', separator: ' '
  %td
    = task.user.login
  %td
    = task.executer.login rescue nil
  %td
    = t("status.#{task.status}")
  %td
    = l(task.start_date, format: :long)
  %td
    = l(task.end_date, format: :long)
  %td
    = label_tag :"bug_#{task.id}", '&nbsp;'.html_safe, class: "checkbox #{'active' if task.bug}"
    = check_box_tag :"bug_#{task.id}", task.id, task.bug, class: 'bug_checkbox'
  %td.take
    = link_to t('status.actions.accept'), task_path(task, task: { status: 'work' }), remote: true, method: :put
    = link_to t('status.actions.finish'), '#', class: 'finish_task', data: { contentid: ".comment_task_form_#{task.id}" }
    = link_to t('status.actions.canсel'), task_path(task, task: { status: 'cancel' }), class: 'cancel_task', remote: true, method: :put, confirm: t('are_you_sure')
  %td
    = link_to '', edit_task_path(task), class: 'edit_row', title: t('edit')

%div{class: "comment_task_form_#{task.id}"}
  = task.id
  = form_for task, remote: true do |f|
    = f.label :comment
    .comment_task
      = f.text_area :comment 
    = link_to t('save'), task_path(task, task: { status: 'finish' }), submit: true, method: :put
    = link_to t('back'), :back, class: 'button'

/ task_path(task, task: { status: 'finish' }),